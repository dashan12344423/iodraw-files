```mermaid
graph TD;

    %% 定义车间调拨流程
    subgraph "车间调拨流程"
        TransferOrderCreate("调拨需求产生") -->|发起调拨流程| StorageTransferOrderCreate("创建调拨基础信息")
        StorageTransferOrderCreate -->|关联调拨物料| StorageCarAllotCreate("添加调拨物料")
        StorageCarAllotCreate -->|记录调入明细| StorageCarAllotDetailCreate("创建调拨明细")
        StorageCarAllotDetailCreate -->|执行调拨| AllotHandle("更新库存")
    end

    %% 提交调拨阶段一（调拨中）
    subgraph "提交调拨阶段一（调拨中）"
        Submit1("提交") --> UpdateTransferOrder1("更新调拨单状态")
        UpdateTransferOrder1 --> UpdateCarAllotOut("修改实际调出数量")
        UpdateCarAllotOut --> UpdateInventoryOverviewOut("更新调出库存总览")
        UpdateInventoryOverviewOut --> CheckOutWarehouseType1("判断是否为非线边库")
        CheckOutWarehouseType1 -->|是| UpdateInventoryDetailOut("更新库存明细")
        CheckOutWarehouseType1 -->|否| UpdateWirelineStorageOut("更新线边库库存")
    end

    %% 提交调拨阶段二（已完成）
    subgraph "提交调拨阶段二（已完成）"
        Submit2("提交") --> UpdateTransferOrder2("更新调拨单状态")
        UpdateTransferOrder2 --> WriteCarAllotDetail("写入调入明细")
        WriteCarAllotDetail --> CalculateTotalIn("汇总实际调入数量")
        CalculateTotalIn --> UpdateInventoryOverviewIn("更新调入库存总览")
        UpdateInventoryOverviewIn --> CheckInWarehouseType("判断是否为非线边库")
        CheckInWarehouseType -->|是| UpdateInventoryDetailIn("更新库存明细")
        CheckInWarehouseType -->|否| UpdateWirelineStorageIn("更新线边库库存")
    end
graph TD;

    %% 定义车间调拨流程
    subgraph "车间调拨流程"
        TransferOrderCreate("调拨需求产生") -->|发起调拨流程| StorageTransferOrderCreate("创建调拨基础信息")
        StorageTransferOrderCreate -->|关联调拨物料| StorageCarAllotCreate("添加调拨物料")
        StorageCarAllotCreate -->|记录调入明细| StorageCarAllotDetailCreate("创建调拨明细")
        StorageCarAllotDetailCreate -->|执行调拨| AllotHandle("更新库存")
    end

    %% 提交调拨阶段一（调拨中）
    subgraph "提交调拨阶段一（调拨中）"
        Submit1("提交") --> UpdateTransferOrder1("更新调拨单状态")
        UpdateTransferOrder1 --> UpdateCarAllotOut("修改实际调出数量")
        UpdateCarAllotOut --> UpdateInventoryOverviewOut("更新调出库存总览")
        UpdateInventoryOverviewOut --> CheckOutWarehouseType1("判断是否为非线边库")
        CheckOutWarehouseType1 -->|是| UpdateInventoryDetailOut("更新库存明细")
        CheckOutWarehouseType1 -->|否| UpdateWirelineStorageOut("更新线边库库存")
    end

    %% 提交调拨阶段二（已完成）
    subgraph "提交调拨阶段二（已完成）"
        Submit2("提交") --> UpdateTransferOrder2("更新调拨单状态")
        UpdateTransferOrder2 --> WriteCarAllotDetail("写入调入明细")
        WriteCarAllotDetail --> CalculateTotalIn("汇总实际调入数量")
        CalculateTotalIn --> UpdateInventoryOverviewIn("更新调入库存总览")
        UpdateInventoryOverviewIn --> CheckInWarehouseType("判断是否为非线边库")
        CheckInWarehouseType -->|是| UpdateInventoryDetailIn("更新库存明细")
        CheckInWarehouseType -->|否| UpdateWirelineStorageIn("更新线边库库存")
    end

```